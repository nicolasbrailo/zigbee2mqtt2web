"use strict";function NVRViewer(props){const[cameras,setCameras]=React.useState([]);const[selectedCam,setSelectedCam]=React.useState(null);const[recordings,setRecordings]=React.useState([]);const[snapshots,setSnapshots]=React.useState([]);const[days,setDays]=React.useState(3);const[isLoading,setIsLoading]=React.useState(true);React.useEffect(()=>{mJsonGet(`${props.api_base_path}/nvr/api/cameras`,cams=>{console.log(cams);setCameras(cams.cameras);if(cams.cameras.length>0){setSelectedCam(cams.cameras[0])}setIsLoading(false)})},[]);React.useEffect(()=>{if(!selectedCam)return;setIsLoading(true);mJsonGet(`${props.api_base_path}/nvr/api/${selectedCam}/recordings?days=${days}`,data=>{setRecordings(data.recordings);setIsLoading(false)},err=>{setIsLoading(false)});mJsonGet(`${props.api_base_path}/nvr/api/${selectedCam}/snapshots`,data=>{setSnapshots(data.snapshots||[])},err=>{setSnapshots([])})},[selectedCam,days]);const formatFilename=filename=>{try{const dateStr=filename.split(".")[0];const hour=dateStr.split("_")[1];const month=parseInt(dateStr.substring(4,6));const day=parseInt(dateStr.substring(6,8));const hr=parseInt(hour.substring(0,2));const minute=parseInt(hour.substring(2,4));const monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];const monthName=monthNames[month-1]||`Month ${month}`;return`${monthName} - ${day.toString().padStart(2,"0")} - ${hr.toString().padStart(2,"0")}:${minute.toString().padStart(2,"0")}`}catch(e){return filename}};const formatSnapshotFilename=filename=>{try{const dateStr=filename.replace("snap_","").split(".")[0];const parts=dateStr.split("_");const datePart=parts[0];const timePart=parts[1];const month=parseInt(datePart.substring(4,6));const day=parseInt(datePart.substring(6,8));const hr=parseInt(timePart.substring(0,2));const minute=parseInt(timePart.substring(2,4));const sec=parseInt(timePart.substring(4,6));const monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];const monthName=monthNames[month-1]||`Month ${month}`;return`${monthName} ${day} - ${hr.toString().padStart(2,"0")}:${minute.toString().padStart(2,"0")}:${sec.toString().padStart(2,"0")}`}catch(e){return filename}};if(isLoading&&cameras.length===0){return React.createElement("div",{className:"card hint"},React.createElement("p",null,"Loading cameras!"),React.createElement("p",null,"Please wait..."))}return React.createElement("section",{id:"zmw_reolink_nvr"},React.createElement("details",{open:true},React.createElement("summary",null,"Config"),cameras.length>1&&React.createElement("select",{value:selectedCam||"",onChange:e=>setSelectedCam(e.target.value)},cameras.map(cam=>React.createElement("option",{key:cam,value:cam},cam))),React.createElement("select",{value:days,onChange:e=>setDays(parseInt(e.target.value))},React.createElement("option",{value:"1"},"Last 1 day"),React.createElement("option",{value:"3"},"Last 3 days"),React.createElement("option",{value:"7"},"Last 7 days"),React.createElement("option",{value:"30"},"Last 30 days"),React.createElement("option",{value:"0"},"All recordings")),React.createElement("button",{onClick:()=>window.location.href="/"},"\u2190 Back to Camera")),isLoading?React.createElement("p",null,"Loading..."):React.createElement(React.Fragment,null,snapshots.length>0&&React.createElement("details",{open:true},React.createElement("summary",null,"Recent Snapshots (",snapshots.length,")"),React.createElement("div",{className:"gallery snapshots"},snapshots.map((snap,idx)=>React.createElement("figure",{key:idx},React.createElement("a",{href:snap.url,target:"_blank"},React.createElement("img",{src:snap.url,alt:snap.filename}),React.createElement("figcaption",null,formatSnapshotFilename(snap.filename))))))),React.createElement("details",{open:true},React.createElement("summary",null,"Recordings (",recordings.length,")"),recordings.length===0?React.createElement("p",null,"No recordings found for the selected period"):React.createElement("div",{className:"gallery"},recordings.map((rec,idx)=>React.createElement("figure",{key:idx},React.createElement("a",{href:rec.video_url,target:"_blank"},React.createElement("img",{src:rec.thumbnail_url||"thumbnail-gen-failed",alt:rec.filename}),React.createElement("figcaption",null,formatFilename(rec.filename)," (",rec.size,")"))))))))}NVRViewer.buildProps=(api_base_path="")=>({key:"nvr_viewer",api_base_path:api_base_path});
