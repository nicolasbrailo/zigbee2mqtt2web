"use strict";class DoorMan extends React.Component{static buildProps(){return{key:"DoorMan"}}constructor(props){super(props);this.state={stats:null};this.fetchStats=this.fetchStats.bind(this);this.refreshInterval=null}async componentDidMount(){this.fetchStats();this.refreshInterval=setInterval(this.fetchStats,10000)}componentWillUnmount(){if(this.refreshInterval){clearInterval(this.refreshInterval)}}on_app_became_visible(){this.fetchStats()}fetchStats(){mJsonGet("/stats",res=>{this.setState({stats:res})})}formatTimestamp(ts){if(!ts)return"?";const date=new Date(ts*1000);return date.toLocaleString()}formatDuration(secs){if(secs===null||secs===undefined)return"?";if(secs<60)return`${secs.toFixed(1)}s`;const mins=Math.floor(secs/60);const remainingSecs=secs%60;return`${mins}m ${remainingSecs.toFixed(0)}s`}renderDoorbellPresses(presses){if(!presses||presses.length===0){return React.createElement("p",null,"No doorbell presses recorded")}return React.createElement("table",null,React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Time"),React.createElement("th",null,"Snap"))),React.createElement("tbody",null,presses.slice().reverse().map((p,i)=>React.createElement("tr",{key:i},React.createElement("td",null,this.formatTimestamp(p.timestamp)),React.createElement("td",null,p.snap_path||"-")))))}renderMotionEvents(events){if(!events||events.length===0){return React.createElement("p",null,"No motion events recorded")}return React.createElement("table",null,React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Time"),React.createElement("th",null,"Duration"))),React.createElement("tbody",null,events.slice().reverse().map((e,i)=>React.createElement("tr",{key:i},React.createElement("td",null,this.formatTimestamp(e.start_time)),React.createElement("td",null,this.formatDuration(e.duration_secs))))))}renderDoorOpenEvents(events){if(!events||events.length===0){return React.createElement("p",null,"No door open events recorded")}return React.createElement("table",null,React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Time"),React.createElement("th",null,"Duration"))),React.createElement("tbody",null,events.slice().reverse().map((e,i)=>React.createElement("tr",{key:i},React.createElement("td",null,this.formatTimestamp(e.start_time)),React.createElement("td",null,this.formatDuration(e.duration_secs))))))}render(){const{stats}=this.state;if(!stats){return React.createElement("div",null,"Loading...")}return React.createElement("div",null,React.createElement("h2",null,"Today"),React.createElement("p",null,"Doorbell presses: ",stats.doorbell_press_count_today),React.createElement("p",null,"Motion detections: ",stats.motion_detection_count_today),React.createElement("h2",null,"Status"),React.createElement("p",null,"Motion in progress: ",stats.motion_in_progress?"Yes":"No"),React.createElement("p",null,"Door open: ",stats.door_open_in_progress?"Yes":"No"),React.createElement("p",null,"Last snap: ",stats.last_snap_path||"-"),React.createElement("h2",null,"Doorbell Presses (last 10)"),this.renderDoorbellPresses(stats.doorbell_presses),React.createElement("h2",null,"Motion Events (last 10)"),this.renderMotionEvents(stats.motion_events),React.createElement("h2",null,"Door Open Events (last 10)"),this.renderDoorOpenEvents(stats.door_open_events))}}
