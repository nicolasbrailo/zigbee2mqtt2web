"use strict";class CronenbergMonitor extends React.Component{static buildProps(){return{key:"CronenbergMonitor"}}constructor(props){super(props);this.state={stats:null};this.fetchStats=this.fetchStats.bind(this)}async componentDidMount(){this.fetchStats()}on_app_became_visible(){this.fetchStats()}fetchStats(){mJsonGet("/stats",res=>{this.setState({stats:res})})}formatDate(dateString){const date=new Date(dateString);return date.toLocaleDateString()}formatTimestamp(isoString){const date=new Date(isoString);return date.toLocaleString()}calculateSummary(){var _this$state$stats;const history=(_this$state$stats=this.state.stats)===null||_this$state$stats===void 0?void 0:_this$state$stats.light_check_history;if(!history||history.length===0){return{forgotten:0,clean:0}}const forgotten=history.filter(s=>s.lights_forgotten).length;const clean=history.filter(s=>!s.lights_forgotten).length;return{forgotten,clean}}renderBatterySection(){const batteryThings=this.state.stats.battery_things||[];if(batteryThings.length===0){return null}const critical=batteryThings.filter(t=>t.battery!==null&&t.battery<15);const low=batteryThings.filter(t=>t.battery!==null&&t.battery>=15&&t.battery<30);const ok=batteryThings.filter(t=>t.battery!==null&&t.battery>=30);const unknown=batteryThings.filter(t=>t.battery===null);return React.createElement("div",{className:"battery-section"},React.createElement("h4",null,"Battery Levels"),React.createElement("ul",{className:"battery-list"},critical.map((thing,idx)=>React.createElement("li",{key:`critical-${idx}`,className:"battery-item battery-critical"},React.createElement("span",{className:"battery-name"},thing.name),React.createElement("span",{className:"battery-level"},thing.battery,"%"))),low.map((thing,idx)=>React.createElement("li",{key:`low-${idx}`,className:"battery-item battery-low"},React.createElement("span",{className:"battery-name"},thing.name),React.createElement("span",{className:"battery-level"},thing.battery,"%"))),ok.map((thing,idx)=>React.createElement("li",{key:`ok-${idx}`,className:"battery-item battery-ok"},React.createElement("span",{className:"battery-name"},thing.name),React.createElement("span",{className:"battery-level"},thing.battery,"%"))),unknown.map((thing,idx)=>React.createElement("li",{key:`unknown-${idx}`,className:"battery-item battery-unknown"},React.createElement("span",{className:"battery-name"},thing.name),React.createElement("span",{className:"battery-level"},"?")))))}render(){if(!this.state.stats){return React.createElement("div",{className:"app-loading"},"Loading...")}const summary=this.calculateSummary();const history=this.state.stats.light_check_history;const vacationsMode=this.state.stats.vacations_mode;const speakerAnnounce=this.state.stats.speaker_announce||[];return React.createElement("div",{id:"CronenbergMonitorContainer"},React.createElement("div",{className:vacationsMode?"card warn":"card hint"},React.createElement("strong",null,"Vacations Mode:")," ",vacationsMode?"Enabled":"Disabled",vacationsMode&&React.createElement("p",null,"Random light effects are active to simulate presence.")),this.renderBatterySection(),speakerAnnounce.length>0&&React.createElement("div",{className:"announcements-section"},React.createElement("h4",null,"Scheduled Announcements"),React.createElement("ul",{className:"announcements-list"},speakerAnnounce.map((announce,idx)=>React.createElement("li",{key:idx,className:"announcement-item"},React.createElement("span",{className:"announcement-time"},announce.time),React.createElement("span",{className:"announcement-msg"},announce.msg),React.createElement("span",{className:"announcement-meta"},"(",announce.lang,", vol: ",announce.vol,")"))))),history.length===0?React.createElement("p",null,"No light checks recorded yet"):React.createElement("div",null,React.createElement("div",{className:"summary-section"},React.createElement("h4",null,"Summary"),React.createElement("div",{className:"summary-stats"},React.createElement("div",{className:"summary-stat"},React.createElement("span",{className:"summary-value forgotten"},summary.forgotten),React.createElement("div",{className:"summary-label"},"Days with lights forgotten")),React.createElement("div",{className:"summary-stat"},React.createElement("span",{className:"summary-value clean"},summary.clean),React.createElement("div",{className:"summary-label"},"Days with no lights on")),React.createElement("div",{className:"summary-stat"},React.createElement("span",{className:"summary-value total"},history.length),React.createElement("div",{className:"summary-label"},"Total checks (last 10 days)")))),React.createElement("h4",null,"Recent Checks"),React.createElement("ul",{className:"checks-list"},history.slice().reverse().map((check,idx)=>this.renderCheck(check,idx)))))}renderCheck(check,idx){const statusClass=check.lights_forgotten?"forgotten":"clear";const statusIcon=check.lights_forgotten?"\u26A0\uFE0F":"\u2713";const statusText=check.lights_forgotten?"Lights forgotten":"All clear";return React.createElement("li",{key:idx,className:`check-item ${statusClass}`},React.createElement("div",{className:"check-header"},React.createElement("div",{className:"check-status"},React.createElement("span",{className:"check-icon"},statusIcon),React.createElement("span",{className:"check-text"},statusText)),React.createElement("div",{className:"check-date"},this.formatDate(check.date)," at ",new Date(check.timestamp).toLocaleTimeString())),check.lights_forgotten&&check.lights_left_on&&check.lights_left_on.length>0&&React.createElement("div",{className:"check-details"},React.createElement("strong",null,"Lights left on:")," ",check.lights_left_on.join(", ")))}}z2mStartReactApp("#app_root",CronenbergMonitor);
