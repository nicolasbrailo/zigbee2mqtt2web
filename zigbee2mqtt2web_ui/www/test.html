<!DOCTYPE html>
<html>
<head>

<link rel="icon" href="favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
<title>BatiCasa</title>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="/www/css/chota.css">
<link rel="stylesheet" href="/www/css/range.css">
<link rel="stylesheet" href="/www/css/custom.css">

<script 
  src="https://code.jquery.com/jquery-3.6.2.min.js" 
  integrity="sha384-hG927x624PENgmWpFXvtXur3MEE0/cNnW0uTi+AcHTSFncBqimnzYyBzy8aFDA1s"
  crossorigin="anonymous">
</script>
<script
  src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.4/socket.io.js"
  integrity="sha384-lix6gfYhwhgbLPheLwgmmEYQL73kK4LcFRUyt6uLa36TY0YZNWCdpidU+HX+gVXN"
  crossorigin="anonymous">
</script>
</head>

<body class="dark">
  <div class="row container" style="margin-top: 5px">
    <div class="col card" id="things_root"></div>
    <div class="col card"  id="others_root"></div>
  </div>
  <div class="container" style="margin-top: 5px">
    <div id="config"></div>
  </div>
</body>

<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
<script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
<script type="text/babel" data-type="module">

class DebouncedRange extends React.Component {
  constructor(props) {
    super(props);

    // Fail early on missing props
    props.min.this_is_a_required_prop;
    props.max.this_is_a_required_prop;
    props.value.this_is_a_required_prop;

    this.state = {
      changing: false,
      pending_update: false,
      value: props.value,
    };
  }

  UNSAFE_componentWillReceiveProps(next_props) {
    this.setState({value: next_props.value});
  }

  onChange(value) {
    this.setState({value: value, pending_update: true});
  }

  onMouseUp(_) {
    this.setState({changing: false, pending_update: false});
    this.props.onChange({target: { value: this.state.value }});
  }

  onMouseDown(_) {
    this.setState({changing: true});
  }

  render() {
    console.log("XXX RENDER RANGE", this.state.value)
    let foo = 'not pressed';
    if (this.state.changing) foo = 'pressed';
    let pend = 'no update pending';
    if (this.state.pending_update) pend = 'pending updt';
    return <div><input type="range"
             onChange={ (evnt) => this.onChange(evnt.target.value)}
             onMouseUp={ (evnt) => { this.onMouseUp(evnt.target.value) }  }
             onMouseDown={ (evnt) => this.onMouseDown(evnt.target.value) }
             onTouchStart={ (evnt) => this.onMouseDown(evnt.target.value)}
             onTouchEnd={ (evnt) => this.onMouseUp(evnt.target.value)}
             min={this.props.min}
             max={this.props.max}
             value={this.state.value} />
          <label>{this.state.value} - {foo} - {pend}</label></div>
  }
}


class Foo extends React.Component {
  constructor(props) {
    super(props);

    props.foo((x) => this.setState(x));
    this.state = {
      bar: 20,
    };
  }

  foo(x) {
      this.setState({bar: x});
  }

  onChange(value) {
      this.setState({bar: value});
  }

  render() {
    console.log("Foo = ", this.state.bar);
    return <DebouncedRange
             onChange={ (evnt) => this.onChange(evnt.target.value)}
             key={`foobar_${this.state.bar}`}
             min="20"
             max="80"
             value={this.state.bar} />
  }
}

function regcb(cb) { window.foocb = cb; }
window.elm = React.createElement(Foo, {foo: regcb});
ReactDOM.createRoot(document.querySelector('#config')).render([
  elm
]);
</script>
</html>



