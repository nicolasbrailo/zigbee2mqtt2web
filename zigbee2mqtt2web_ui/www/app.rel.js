"use strict";function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,_toPropertyKey(c.key),c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}function _toPropertyKey(a){var b=_toPrimitive(a,"string");return"symbol"===_typeof(b)?b:b+""}function _toPrimitive(a,b){if("object"!==_typeof(a)||null===a)return a;var c=a[Symbol.toPrimitive];if(c!==void 0){var d=c.call(a,b||"default");if("object"!==_typeof(d))return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===b?String:Number)(a)}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){if(b&&("object"===_typeof(b)||"function"==typeof b))return b;if(void 0!==b)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var ConfigPane_MQTT_MaxLogLines=30,ConfigPane=function(a){function b(a){var d;return _classCallCheck(this,b),d=c.call(this,a),d.reorderThings=d.reorderThings.bind(_assertThisInitialized(d)),d.reloadThings=d.reloadThings.bind(_assertThisInitialized(d)),d.toggleExpanded=d.toggleExpanded.bind(_assertThisInitialized(d)),d.toggleMqttFeed=d.toggleMqttFeed.bind(_assertThisInitialized(d)),d.showMqttMapConfirm=d.showMqttMapConfirm.bind(_assertThisInitialized(d)),d.userRequestedMqttNetworkmapRefresh=d.userRequestedMqttNetworkmapRefresh.bind(_assertThisInitialized(d)),d.state={expanded:!1,showingMqttFeed:!1,showMqttMapConfirm:!1,newMqttMapAvailable:!1,mqttLog:[]},d}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"maybeSubscribeToMqtt",value:function maybeSubscribeToMqtt(a){var b=this,c=a&&this.state.showingMqttFeed,d=!a&&!this.state.showingMqttFeed;if(!(c||d)){var e=function(a){var c=new Date,d=("0"+c.getHours()).slice(-2),e=("0"+c.getMinutes()).slice(-2),f=("0"+c.getSeconds()).slice(-2),g="".concat(d,":").concat(e,":").concat(f),h=b.state.mqttLog;h.push("".concat(g,": ").concat(JSON.stringify(a))),h.length>ConfigPane_MQTT_MaxLogLines&&(h=h.slice(1)),b.setState({mqttLog:h})};a?(e("MQTT feed started"),this.props.remote_thing_registry.subscribe_to_mqtt_stream("ConfigPane",function(a){return e(a)})):(this.props.remote_thing_registry.unsubscribe_to_mqtt_stream("ConfigPane"),e("MQTT feed stopped"))}}},{key:"reorderThings",value:function reorderThings(){this.props.cbOnReorderThings.toggle()}},{key:"reloadThings",value:function reloadThings(){this.props.thing_registry.reloadThings()}},{key:"toggleExpanded",value:function toggleExpanded(){var a=!this.state.expanded,b=a&&this.state.showingMqttFeed;this.maybeSubscribeToMqtt(b),this.setState({expanded:a,showingMqttFeed:b})}},{key:"toggleMqttFeed",value:function toggleMqttFeed(){var a=!this.state.showingMqttFeed;this.maybeSubscribeToMqtt(a),this.setState({showingMqttFeed:a})}},{key:"showMqttMapConfirm",value:function showMqttMapConfirm(){this.setState({showMqttMapConfirm:!this.state.showMqttMapConfirm})}},{key:"userRequestedMqttNetworkmapRefresh",value:function userRequestedMqttNetworkmapRefresh(){var a=this;this.setState({mqttNetworkmapRequestInProgress:!0}),this.props.thing_registry.request_new_mqtt_networkmap().done(function(){console.log("New networkmap may be available"),a.setState({showMqttMapConfirm:!1,newMqttMapAvailable:!0})})}},{key:"render",value:function render(){return this.state.expanded?this.render_expanded():this.render_minimized()}},{key:"render_minimized",value:function render_minimized(){return React.createElement("div",{id:"ConfigPane_config_options"},React.createElement("button",{className:"modal-button",onClick:this.toggleExpanded},"Options"))}},{key:"render_expanded",value:function render_expanded(){return React.createElement("div",{key:"ConfigPane_config_options",id:"ConfigPane_config_options",className:"modal"},React.createElement("button",{className:"modal-button",onClick:this.toggleExpanded},"X"),React.createElement("ul",{key:"ConfigPane_config_options"},React.createElement("li",null,React.createElement("button",{onClick:this.reorderThings},"Reorder things")),React.createElement("li",null,React.createElement("button",{onClick:this.reloadThings},"Reload things")),React.createElement("li",null,React.createElement("button",null,"List hidden / broken things")),React.createElement("li",null,this.renderMqttNetworkMapOptions()),React.createElement("li",null,React.createElement("button",{onClick:this.toggleMqttFeed},"Show MQTT message feed"),this.render_mqtt_feed()),React.createElement("li",null,React.createElement("button",{id:"syslogOpenNewWindow",onClick:function onClick(){return window.open("/syslog/500")}},"Syslog"))))}},{key:"render_mqtt_feed",value:function render_mqtt_feed(){return this.state.showingMqttFeed?React.createElement("div",{className:"card container",id:"ConfigPane_mqtt_feed",key:"ConfigPane_mqtt_feed"},React.createElement("ul",null,this.state.mqttLog.map(function(a,b){return React.createElement("li",{key:"{mqttlog_".concat(b,"}")},a)}))):""}},{key:"renderMqttNetworkMapOptions",value:function renderMqttNetworkMapOptions(){if(!this.state.showMqttMapConfirm)return React.createElement("button",{onClick:this.showMqttMapConfirm},"Show MQTT network");var a=React.createElement("button",{id:"openNetworkmapNewWindow",onClick:function onClick(){window.open("mqtt_networkmap.html")}},"Load MQTT network map from cache");return this.state.newMqttMapAvailable?React.createElement("div",{className:"container card"},React.createElement("div",{className:"row"},React.createElement("button",{className:"modal-button",onClick:this.showMqttMapConfirm},"X"),a)):this.state.mqttNetworkmapRequestInProgress?React.createElement("div",{className:"container card"},React.createElement("div",{className:"row"},React.createElement("button",{className:"modal-button",onClick:this.showMqttMapConfirm},"X")),React.createElement("div",{className:"row"},React.createElement("label",null,"A request for a new networkmap is in progress. If you miss the reply (eg by closing this window) you can request the cached map next time.")),React.createElement("div",{className:"row"},React.createElement("button",{disabled:!0},"MQTT network map request in progress"),a)):React.createElement("div",{className:"container card"},React.createElement("div",{className:"row"},React.createElement("button",{className:"modal-button",onClick:this.showMqttMapConfirm},"X")),React.createElement("div",{className:"row"},React.createElement("label",null,"Caution: this may make your network unresponsive for a few minutes. The response may take a few minutes to arrive too. Alternatively, you can try getting the cached networkmap.")),React.createElement("div",{className:"row"},React.createElement("button",{onClick:this.userRequestedMqttNetworkmapRefresh},"Request MQTT network map"),a))}}],[{key:"buildProps",value:function buildProps(a,b,c){return{key:"global_config",thing_registry:a,remote_thing_registry:b,cbOnReorderThings:c}}}]),b}(React.Component);
"use strict";function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,_toPropertyKey(c.key),c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}function _toPropertyKey(a){var b=_toPrimitive(a,"string");return"symbol"===_typeof(b)?b:b+""}function _toPrimitive(a,b){if("object"!==_typeof(a)||null===a)return a;var c=a[Symbol.toPrimitive];if(c!==void 0){var d=c.call(a,b||"default");if("object"!==_typeof(d))return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===b?String:Number)(a)}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){if(b&&("object"===_typeof(b)||"function"==typeof b))return b;if(void 0!==b)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var DebouncedRange=function(a){function b(a){var d;_classCallCheck(this,b),d=c.call(this,a),a.min.this_is_a_required_prop,a.max.this_is_a_required_prop,a.value.this_is_a_required_prop;var e=a.value?a.value:a.min;return d.state={changing:!1,value:e},d}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"UNSAFE_componentWillReceiveProps",value:function UNSAFE_componentWillReceiveProps(a){var b=a&&a.value?a.value:0;this.setState({value:b})}},{key:"onChange",value:function onChange(a){this.setState({value:a})}},{key:"onMouseUp",value:function onMouseUp(){this.setState({changing:!1}),this.props.onChange({target:{value:this.state.value}})}},{key:"onMouseDown",value:function onMouseDown(){this.setState({changing:!0})}},{key:"render",value:function render(){var a=this;return React.createElement("input",{type:"range",onChange:function onChange(b){return a.onChange(b.target.value)},onMouseUp:function onMouseUp(b){a.onMouseUp(b.target.value)},onMouseDown:function onMouseDown(b){return a.onMouseDown(b.target.value)},onTouchStart:function onTouchStart(b){return a.onMouseDown(b.target.value)},onTouchEnd:function onTouchEnd(b){return a.onMouseUp(b.target.value)},className:this.props.className,min:this.props.min,max:this.props.max,value:this.state.value})}}]),b}(React.Component);
"use strict";function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _createForOfIteratorHelper(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!c){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=c.call(a)},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,_toPropertyKey(c.key),c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}function _toPropertyKey(a){var b=_toPrimitive(a,"string");return"symbol"===_typeof(b)?b:b+""}function _toPrimitive(a,b){if("object"!==_typeof(a)||null===a)return a;var c=a[Symbol.toPrimitive];if(c!==void 0){var d=c.call(a,b||"default");if("object"!==_typeof(d))return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===b?String:Number)(a)}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){if(b&&("object"===_typeof(b)||"function"==typeof b))return b;if(void 0!==b)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var Light=function(a){function b(a){var d;return _classCallCheck(this,b),d=c.call(this,a),d.state={state:!1,brightness:a.brightness_min,color_temp:a.color_temp_min,color_rgb:"",details_shown:!1},d.props.thing_registry.subscribe_to_state_updates(d.props.name,function(a){d.setState(a)}),d}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"setLightOn",value:function setLightOn(a){this.setState({state:a}),this.props.thing_registry.set_thing(this.props.name,"state=".concat(a))}},{key:"changeBrightness",value:function changeBrightness(a){0==a?this.setState({brightness:0,state:!1}):this.setState({brightness:a,state:!0}),this.props.thing_registry.set_thing(this.props.name,"brightness=".concat(a))}},{key:"changeColorTemp",value:function changeColorTemp(a){this.setState({color_temp:a}),this.props.thing_registry.set_thing(this.props.name,"color_temp=".concat(a))}},{key:"toggleDetailsPanel",value:function toggleDetailsPanel(){this.setState({details_shown:!this.state.details_shown})}},{key:"changeRGB",value:function changeRGB(a){this.setState({color_rgb:a}),this.props.thing_registry.set_thing(this.props.name,"color_rgb=".concat(a))}},{key:"render",value:function render(){var a=this;return React.createElement("div",{className:"thing_div",key:"".concat(this.props.name,"_light_div")},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-primary-action"},React.createElement("input",{type:"checkbox",checked:this.state.state,value:this.state.state,onChange:function onChange(b){return a.setLightOn(b.target.checked)},key:"".concat(this.props.name,"_light_is_on")})),React.createElement("div",{className:"col-fixed-fill"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-fixed-fill"},React.createElement("label",{className:"thing_name",htmlFor:"".concat(this.props.name,"_light_is_on")},this.props.name)),this.render_details_toggle()),React.createElement("div",{className:"row"},this.render_brightness_select()))),this.render_details_panel())}},{key:"render_details_toggle",value:function render_details_toggle(){return this.props.has_extra_details?React.createElement("div",{key:"".concat(this.props.name,"_light_details_panel_toggle_div"),className:"toggle-details-panel"},this.render_details_toggle_link()):""}},{key:"render_details_toggle_link",value:function render_details_toggle_link(){var a=this;return this.state.details_shown?React.createElement("a",{key:"".concat(this.props.name,"_light_details_panel_toggle"),onClick:function onClick(){return a.toggleDetailsPanel()}},"\u25B2"):React.createElement("a",{key:"".concat(this.props.name,"_light_details_panel_toggle"),onClick:function onClick(){return a.toggleDetailsPanel()}},"\u25BC")}},{key:"render_details_panel",value:function render_details_panel(){return this.props.has_extra_details?this.state.details_shown?React.createElement("div",{className:"card modal"},[this.render_rgb_picker(),this.render_color_temp()]):"":""}},{key:"render_brightness_select",value:function render_brightness_select(){var a=this;return this.props.supports_brightness?React.createElement(DebouncedRange,{onChange:function onChange(b){return a.changeBrightness(b.target.value)},key:"".concat(this.props.name,"_light_brightness_slider"),min:this.props.brightness_min,max:this.props.brightness_max,value:this.state.brightness}):""}},{key:"render_color_temp",value:function render_color_temp(){var a=this;return this.props.supports_color_temp?React.createElement("div",{key:"".concat(this.props.name,"_div_color_temp")},React.createElement("label",null,"Temperature"),React.createElement(DebouncedRange,{onChange:function onChange(b){return a.changeColorTemp(b.target.value)},key:"".concat(this.props.name,"_light_color_temp"),min:this.props.color_temp_min,max:this.props.color_temp_max,value:this.state.color_temp}),this.render_color_temp_presets()):""}},{key:"render_color_temp_presets",value:function render_color_temp_presets(){var a=this;if(!this.props.color_temp_presets||0==this.props.color_temp_presets.length)return"";var b,c=[],d=_createForOfIteratorHelper(this.props.color_temp_presets);try{for(d.s();!(b=d.n()).done;){var e=b.value;c.push(React.createElement("option",{key:"".concat(this.props.name,"_option_color_temp_preset_").concat(e.name),value:e.value},e.name))}}catch(a){d.e(a)}finally{d.f()}return React.createElement("select",{onChange:function onChange(b){return a.changeColorTemp(b.target.value)},key:"".concat(this.props.name,"_div_color_temp_presets"),value:""},c)}},{key:"render_rgb_picker",value:function render_rgb_picker(){var a=this;return this.props.supports_rgb?React.createElement("div",{key:"".concat(this.props.name,"_div_color_picker")},React.createElement("label",null,"Lamp color"),React.createElement("input",{type:"color",onChange:function onChange(b){return a.changeRGB(b.target.value)},key:"".concat(this.props.name,"_light_rgb"),value:this.state.color_rgb})):""}}],[{key:"buildProps",value:function buildProps(a,b){for(var c={thing_registry:a,name:b.name,description:b.description,manufacturer:b.manufacturer,model:b.model,supports_brightness:!1,brightness_min:0,brightness_max:0,supports_color_temp:!1,color_temp_min:0,color_temp_max:0,color_temp_presets:[],supports_rgb:!1},d=0,e=Object.keys(b.actions);d<e.length;d++){var f=e[d],g=b.actions[f].value.meta;g||(g={}),"brightness"==f?(c.supports_brightness=!0,c.brightness_min=g.value_min,c.brightness_max=g.value_max):"color_temp"==f?(c.supports_color_temp=!0,c.color_temp_min=g.value_min,c.color_temp_max=g.value_max,c.color_temp_presets=g.presets):"color_rgb"==f&&(c.supports_rgb=!0)}return c.has_extra_details=c.supports_color_temp||c.supports_rgb,c}}]),b}(React.Component);
"use strict";function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,_toPropertyKey(c.key),c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}function _toPropertyKey(a){var b=_toPrimitive(a,"string");return"symbol"===_typeof(b)?b:b+""}function _toPrimitive(a,b){if("object"!==_typeof(a)||null===a)return a;var c=a[Symbol.toPrimitive];if(c!==void 0){var d=c.call(a,b||"default");if("object"!==_typeof(d))return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===b?String:Number)(a)}var MAX_CACHE_AGE_SECS=259200,LocalStorageManager=function(){function a(){_classCallCheck(this,a),this.max_cache_age_secs=MAX_CACHE_AGE_SECS,this.cache_idx=this.get("cache_idx",{}),_typeof(this.cache_idx)!=_typeof({})&&(console.error("Can't read local storage, will clear cache"),this.cache_idx={},this.save("cache_idx",this.cache_idx),localStorage.clear())}return _createClass(a,[{key:"get",value:function get(a,b){try{var c=JSON.parse(localStorage.getItem(a));return c?c:b}catch(a){return b}}},{key:"save",value:function save(a,b){localStorage.setItem(a,JSON.stringify(b))}},{key:"remove",value:function remove(a){localStorage.removeItem(a)}},{key:"_cacheGet",value:function _cacheGet(a){var b=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],c=this.cache_idx[a]||0,d=Date.now()-c,e=d>1e3*this.max_cache_age_secs;return e&&!b?(localStorage.removeItem(a),null):this.get(a,null)}},{key:"cacheGet",value:function cacheGet(a){return this._cacheGet(a)}},{key:"cacheGet_ignoreExpire",value:function cacheGet_ignoreExpire(a){return this._cacheGet(a,!0)}},{key:"cacheSave",value:function cacheSave(a,b){this.cache_idx[a]=Date.now(),this.save("cache_idx",this.cache_idx),this.save(a,b)}}]),a}();
"use strict";function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _createForOfIteratorHelper(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!c){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=c.call(a)},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,_toPropertyKey(c.key),c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}function _toPropertyKey(a){var b=_toPrimitive(a,"string");return"symbol"===_typeof(b)?b:b+""}function _toPrimitive(a,b){if("object"!==_typeof(a)||null===a)return a;var c=a[Symbol.toPrimitive];if(c!==void 0){var d=c.call(a,b||"default");if("object"!==_typeof(d))return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===b?String:Number)(a)}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){if(b&&("object"===_typeof(b)||"function"==typeof b))return b;if(void 0!==b)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var MediaPlayer=function(a){function b(a){var d;return _classCallCheck(this,b),d=c.call(this,a),d.state={is_authenticated:!0,volume:0,media_info:null},d.props.thing_registry.get_thing_action_state(d.props.player.name,"media_player_state").then(function(a){a.volume||(a.volume=0),d.setState(a)}),d.onPlayClicked=d.onPlayClicked.bind(_assertThisInitialized(d)),d.onStopClicked=d.onStopClicked.bind(_assertThisInitialized(d)),d.onVolumeChanged=d.onVolumeChanged.bind(_assertThisInitialized(d)),d.onNextClicked=d.onNextClicked.bind(_assertThisInitialized(d)),d.onPrevClicked=d.onPrevClicked.bind(_assertThisInitialized(d)),d.onTTSRequested=d.onTTSRequested.bind(_assertThisInitialized(d)),d.onAnnouncementRequested=d.onAnnouncementRequested.bind(_assertThisInitialized(d)),d}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"onPlayClicked",value:function onPlayClicked(){this.props.thing_registry.set_thing(this.props.player.name,"toggle_play")}},{key:"onStopClicked",value:function onStopClicked(){this.props.thing_registry.set_thing(this.props.player.name,"stop")}},{key:"onNextClicked",value:function onNextClicked(){this.props.thing_registry.set_thing(this.props.player.name,"relative_jump_to_track=1")}},{key:"onPrevClicked",value:function onPrevClicked(){this.props.thing_registry.set_thing(this.props.player.name,"relative_jump_to_track=-1")}},{key:"onVolumeChanged",value:function onVolumeChanged(a){var b=a.target.value;this.props.thing_registry.set_thing(this.props.player.name,"volume=".concat(b))}},{key:"onTTSRequested",value:function onTTSRequested(){return this.props.can_tts?void showGlobalError("Requested unsupported action 'announcement' on player ".concat(this.props.player.name)):void showGlobalError("Y")}},{key:"onAnnouncementRequested",value:function onAnnouncementRequested(){return this.props.can_announce?void showGlobalError("Requested unsupported action 'announcement' on player ".concat(this.props.player.name)):void showGlobalError("X")}},{key:"render",value:function render(){return!1==this.state.is_authenticated?this.render_no_auth():this.state.media_info&&0!=Object.keys(this.state.media_info).length?this.render_playing_media():this.render_no_media()}},{key:"render_no_auth",value:function render_no_auth(){return React.createElement("div",{className:"bd-error text-error",key:"".concat(this.props.player.name,"_media_player_div")},this.props.player.name," is not authenticated. Goto ",React.createElement("a",{href:this.state.reauth_url,target:"_blank"},"reauthentication page")," then refresh this page.")}},{key:"render_announce_or_tts",value:function render_announce_or_tts(){var a=[];return this.props.can_tts&&a.push(React.createElement("button",{key:"MediaPlayer_".concat(this.props.player.name,"_tts_btn"),className:"player-button",onClick:this.onTTSRequested},"TTS")),this.props.can_announce&&a.push(React.createElement("button",{key:"MediaPlayer_".concat(this.props.player.name,"_announce_btn"),className:"player-button",onClick:this.onAnnouncementRequested},"Say")),a}},{key:"render_no_media",value:function render_no_media(){return this.render_announce_or_tts()}},{key:"render_playing_media",value:function render_playing_media(){return React.createElement("div",{className:"thing_div row container",key:"".concat(this.props.player.name,"_media_player_div")},"this.render_announce_or_tts();",React.createElement("table",null,React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",{className:"col-media-icon"},React.createElement("img",{className:"media-icon",src:this.state.media_info.icon})),React.createElement("td",{className:"col-media-mainpanel"},React.createElement("div",{className:"media-info-label"},this.state.media_info.title," - ",this.state.media_info.album_name),React.createElement("div",{className:"media-info-label"},this.props.player.name," - ",this.state.media_info.artist),React.createElement("button",{className:"player-button",onClick:this.onPlayClicked},"\u23EF\uFE0F"),React.createElement(DebouncedRange,{className:"player-volume",onChange:this.onVolumeChanged,key:"".concat(this.props.player.name,"_set_volume"),min:"0",max:"100",value:this.state.volume}),React.createElement("button",{className:"player-button",onClick:this.onPrevClicked},"\u23EA\uFE0F"),React.createElement("button",{className:"player-button",onClick:this.onNextClicked},"\u23ED\uFE0F"))))))}}],[{key:"buildProps",value:function buildProps(a,b){return{thing_registry:a,player:b,can_tts:Object.keys(b.actions).includes("tts_announce"),can_announce:Object.keys(b.actions).includes("play_announcement")}}}]),b}(React.Component),MediaPlayerList=function(a){function b(a){return _classCallCheck(this,b),c.call(this,a)}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"render",value:function render(){if(0==this.props.media_players.length)return"";var a,b=[],c=_createForOfIteratorHelper(this.props.media_players);try{for(c.s();!(a=c.n()).done;){var d=a.value;b.push(React.createElement("li",{key:"MediaPlayerList_li_".concat(d.name)},React.createElement(MediaPlayer,MediaPlayer.buildProps(this.props.thing_registry,d))))}}catch(a){c.e(a)}finally{c.f()}return React.createElement("ul",{id:"MediaPlayerList"},b)}}],[{key:"buildProps",value:function buildProps(a){return{thing_registry:a,media_players:a.mediaplayer_things,key:"MediaPlayerList"}}}]),b}(React.Component);
"use strict";function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,_toPropertyKey(c.key),c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}function _toPropertyKey(a){var b=_toPrimitive(a,"string");return"symbol"===_typeof(b)?b:b+""}function _toPrimitive(a,b){if("object"!==_typeof(a)||null===a)return a;var c=a[Symbol.toPrimitive];if(c!==void 0){var d=c.call(a,b||"default");if("object"!==_typeof(d))return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===b?String:Number)(a)}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){if(b&&("object"===_typeof(b)||"function"==typeof b))return b;if(void 0!==b)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var ScenesPane=function(a){function b(a){return _classCallCheck(this,b),c.call(this,a)}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"requestScene",value:function requestScene(a){console.log("Requesting scene ".concat(a)),this.props.thing_registry.set_thing(this.props.scenes.name,a)}},{key:"render",value:function render(){var a=this;if(!this.props.scenes)return"";for(var b=[],c=function _loop(){var c=e[d];b.push(React.createElement("li",{key:"scene_".concat(c)},React.createElement("button",{key:"button_set_scene_{$scene_name}",onClick:function onClick(){return a.requestScene(c)}},c)))},d=0,e=Object.keys(this.props.scenes.actions);d<e.length;d++)c();return React.createElement("div",{id:"scenes",className:"card",key:"scenes_list"},React.createElement("ul",null,b))}}]),b}(React.Component);
"use strict";function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _createForOfIteratorHelper(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!c){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=c.call(a)},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,_toPropertyKey(c.key),c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}function _toPropertyKey(a){var b=_toPrimitive(a,"string");return"symbol"===_typeof(b)?b:b+""}function _toPrimitive(a,b){if("object"!==_typeof(a)||null===a)return a;var c=a[Symbol.toPrimitive];if(c!==void 0){var d=c.call(a,b||"default");if("object"!==_typeof(d))return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===b?String:Number)(a)}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){if(b&&("object"===_typeof(b)||"function"==typeof b))return b;if(void 0!==b)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}function simple_dygraph_plot(a,b){var c={fillGraph:!1,connectSeparatedPoints:!0,highlightCircleSize:2,strokeWidth:1,rollPeriod:5,legend:"always",highlightSeriesOpts:{strokeWidth:3,strokeBorderWidth:1,highlightCircleSize:5}};$.ajax({url:b,cache:!1,type:"get",dataType:"text",success:function success(b){var d=document.getElementById(a+"_label");d&&(c.labelsDiv=d),new Dygraph(document.getElementById(a),b,c)}})}var SensorsHistoryPane=function(a){function b(a){var d;return _classCallCheck(this,b),d=c.call(this,a),d.toggleExpanded=d.toggleExpanded.bind(_assertThisInitialized(d)),d.state={expanded:!1},d}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"toggleExpanded",value:function toggleExpanded(){this.setState({expanded:!this.state.expanded})}},{key:"render",value:function render(){if(!this.state.expanded)return this.render_minimized();var a,b=this.render_expanded(),c=_createForOfIteratorHelper(this.props.metrics_to_plot);try{for(c.s();!(a=c.n()).done;){var d=a.value;simple_dygraph_plot("local_plot_".concat(d),"/sensors/get_single_metric_in_all_sensors_csv/".concat(d))}}catch(a){c.e(a)}finally{c.f()}return b}},{key:"render_minimized",value:function render_minimized(){return React.createElement("button",{className:"modal-button",onClick:this.toggleExpanded},"Sensors history")}},{key:"render_expanded",value:function render_expanded(){var a,b=[],c=_createForOfIteratorHelper(this.props.metrics_to_plot);try{for(c.s();!(a=c.n()).done;){var d=a.value;b.push(React.createElement("div",{className:"col card",key:"local_plot_".concat(d,"_div")},React.createElement("h3",null,d),React.createElement("div",{id:"local_plot_".concat(d)}),React.createElement("div",{id:"local_plot_".concat(d,"_label")})))}}catch(a){c.e(a)}finally{c.f()}return React.createElement("div",{id:"SensorsHistoryPane",className:"card container row col"},React.createElement("button",{className:"modal-button",onClick:this.toggleExpanded},"X"),React.createElement("div",{className:"row"},b))}}],[{key:"buildProps",value:function buildProps(a,b){return{thing_registry:a,metrics_to_plot:b,key:"SensorsHistoryPane"}}}]),b}(React.Component);
"use strict";function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _createForOfIteratorHelper(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!c){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=c.call(a)},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,_toPropertyKey(c.key),c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){if(b&&("object"===_typeof(b)||"function"==typeof b))return b;if(void 0!==b)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}function _defineProperty(a,b,c){return b=_toPropertyKey(b),b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _toPropertyKey(a){var b=_toPrimitive(a,"string");return"symbol"===_typeof(b)?b:b+""}function _toPrimitive(a,b){if("object"!==_typeof(a)||null===a)return a;var c=a[Symbol.toPrimitive];if(c!==void 0){var d=c.call(a,b||"default");if("object"!==_typeof(d))return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===b?String:Number)(a)}var SensorsPane=function(a){function b(a){var d;_classCallCheck(this,b),d=c.call(this,a),d.state={sensors:a.sensors};var e,f=_createForOfIteratorHelper(d.props.sensor_names);try{var g=function _loop(){var b=e.value;a.thing_registry.subscribe_to_state_updates(b,function(a){d._updateSensor(b,a)})};for(f.s();!(e=f.n()).done;)g()}catch(a){f.e(a)}finally{f.f()}return d}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"_updateSensor",value:function _updateSensor(a,b){var c,d=this.state.sensors,e=Object.keys(b),f=_createForOfIteratorHelper(this.props.all_known_metrics);try{for(f.s();!(c=f.n()).done;){var g=c.value;if(e.includes(g)){var h=b[g];!0===h&&(h="Y"),!1===h&&(h="N"),d[a][g]=h}else d[a][g]=null}}catch(a){f.e(a)}finally{f.f()}var i=new Date,j=("0"+i.getHours()).slice(-2),k=("0"+i.getMinutes()).slice(-2);d[a].update_time="".concat(j,":").concat(k),this.setState({sensors:d})}},{key:"render",value:function render(){return React.createElement("div",{className:"card",key:"sensors_pane",id:"sensors_pane"},React.createElement("ul",null,this.render_sensor_list()))}},{key:"render_sensor_list",value:function render_sensor_list(){var a,b=[],c=_createForOfIteratorHelper(this.props.sensor_names);try{for(c.s();!(a=c.n()).done;){var d=a.value;b.push(React.createElement("li",{key:"sensor_".concat(d,"_li")},React.createElement("label",null,d),React.createElement("ul",{key:"sensor_".concat(d,"_row")},this.render_metrics_for_sensor(d))))}}catch(a){c.e(a)}finally{c.f()}return b}},{key:"render_metrics_for_sensor",value:function render_metrics_for_sensor(a){var c,d=[],e=_createForOfIteratorHelper(this.props.all_known_metrics);try{for(e.s();!(c=e.n()).done;){var f=c.value;null!==this.state.sensors[a][f]&&d.push(React.createElement("li",{key:"sensor_".concat(a,"_metric_").concat(f)},React.createElement("label",null,b.prettyMetricName(f)),this.state.sensors[a][f],React.createElement("label",null,b.prettyMetricUnit(f))))}}catch(a){e.e(a)}finally{e.f()}return d}}],[{key:"prettyMetricName",value:function prettyMetricName(a){return"temperature"===a?"":"humidity"===a?"":"update_time"===a?"@":"contact"===a?"Closed":"occupancy"===a?"Occupancy":a}},{key:"prettyMetricUnit",value:function prettyMetricUnit(a){return"temperature"===a?"\xB0C":"humidity"===a?"%RH":"update_time"===a?"":"contact"===a?"":"occupancy"===a?"":a}},{key:"getSensorMetrics",value:function getSensorMetrics(a){for(var c,d=[],e=0,f=Object.keys(a.actions);e<f.length;e++)c=f[e],b.SensorMetrics.includes(c)&&d.push(c);return d}},{key:"buildProps",value:function buildProps(a){var c,d={},e=_createForOfIteratorHelper(a.sensor_things);try{for(e.s();!(c=e.n()).done;){var f,g=c.value,h={},i=_createForOfIteratorHelper(b.getSensorMetrics(g));try{for(i.s();!(f=i.n()).done;){var j=f.value;d[g.name]||(d[g.name]={}),d[g.name][j]=g.actions[j].value._current}}catch(a){i.e(a)}finally{i.f()}}}catch(a){e.e(a)}finally{e.f()}var k=b.SensorMetrics;return k.push("update_time"),{key:"sensor_pane_component",sensors:d,sensor_names:Object.keys(d),all_known_metrics:k,thing_registry:a}}}]),b}(React.Component);_defineProperty(SensorsPane,"SensorMetrics",["temperature","humidity","occupancy","contact"]);
"use strict";function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,_toPropertyKey(c.key),c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}function _toPropertyKey(a){var b=_toPrimitive(a,"string");return"symbol"===_typeof(b)?b:b+""}function _toPrimitive(a,b){if("object"!==_typeof(a)||null===a)return a;var c=a[Symbol.toPrimitive];if(c!==void 0){var d=c.call(a,b||"default");if("object"!==_typeof(d))return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===b?String:Number)(a)}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){if(b&&("object"===_typeof(b)||"function"==typeof b))return b;if(void 0!==b)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var Switch=function(a){function b(a){var d;return _classCallCheck(this,b),d=c.call(this,a),d.state={state:!1},a.thing_registry.get_thing_state(a.name).then(function(a){d.setState(a)}),d}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"setSwitchOn",value:function setSwitchOn(a){this.setState({state:a}),this.props.thing_registry.set_thing(this.props.name,"state=".concat(a))}},{key:"render",value:function render(){var a=this;return React.createElement("div",{className:"thing_div",key:"".concat(this.props.name,"_switch_div")},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-primary-action"},React.createElement("input",{type:"checkbox",checked:this.state.state,value:this.state.state,onChange:function onChange(b){return a.setSwitchOn(b.target.checked)},key:"".concat(this.props.name,"_switch_is_on")})),React.createElement("div",{className:"col-fixed-fill"},React.createElement("label",{className:"thing_name",htmlFor:"".concat(this.props.name,"_switch_is_on")},this.props.name))))}}],[{key:"buildProps",value:function buildProps(a,b){return{thing_registry:a,name:b.name,description:b.description,manufacturer:b.manufacturer,model:b.model}}}]),b}(React.Component);
"use strict";function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _createForOfIteratorHelper(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!c){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=c.call(a)},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,_toPropertyKey(c.key),c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}function _toPropertyKey(a){var b=_toPrimitive(a,"string");return"symbol"===_typeof(b)?b:b+""}function _toPrimitive(a,b){if("object"!==_typeof(a)||null===a)return a;var c=a[Symbol.toPrimitive];if(c!==void 0){var d=c.call(a,b||"default");if("object"!==_typeof(d))return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===b?String:Number)(a)}var ThingRegistry=function(){function a(b,c){var d=this;_classCallCheck(this,a),this._state_update_callbacks={},this.cache=b,this.remote_thing_registry=c,this.full_network_map_metas_cache_key="network_map_meta",this.network_lights_metas_cache_key="things_metas_lights",this.network_switches_metas_cache_key="things_metas_switches",this.network_sensors_metas_cache_key="things_metas_sensors",this.network_buttons_metas_cache_key="things_metas_buttons",this.network_mediaplayers_metas_cache_key="things_metas_mediaplayers",this.network_unknowns_metas_cache_key="things_metas_unknowns",this.scenes_metas_cache_key="things_metas_scenes",this.lights=this.cache.cacheGet_ignoreExpire(this.network_lights_metas_cache_key),this.switches=this.cache.cacheGet_ignoreExpire(this.network_switches_metas_cache_key),this.sensor_things=this.cache.cacheGet_ignoreExpire(this.network_sensors_metas_cache_key),this.button_things=this.cache.cacheGet_ignoreExpire(this.network_buttons_metas_cache_key),this.mediaplayer_things=this.cache.cacheGet_ignoreExpire(this.network_mediaplayers_metas_cache_key),this.unknown_things=this.cache.cacheGet_ignoreExpire(this.network_unknowns_metas_cache_key),this.scenes=this.cache.cacheGet_ignoreExpire(this.scenes_metas_cache_key),this.probably_needs_network_rebuild=!1,this.lights||(this.lights=[],this.probably_needs_network_rebuild=!0),this.switches||(this.switches=[],this.probably_needs_network_rebuild=!0),this.unknown_things||(this.unknown_things=[],this.probably_needs_network_rebuild=!0),this.sensor_things||(this.sensor_things=[],this.probably_needs_network_rebuild=!0),this.button_things||(this.button_things=[],this.probably_needs_network_rebuild=!0),this.mediaplayer_things||(this.mediaplayer_things=[],this.probably_needs_network_rebuild=!0),this.scenes||(this.scenes=[],this.probably_needs_network_rebuild=!0),c.subscribe_to_mqtt_stream("ThingRegistry",function(a){return d._on_mqtt_state_update(a)})}return _createClass(a,[{key:"subscribe_to_state_updates",value:function subscribe_to_state_updates(a,b){this._state_update_callbacks[a]=b}},{key:"updateWorldState",value:function updateWorldState(){var a=this;this.remote_thing_registry.get_world().then(function(b){var c,d=Object.keys(a._state_update_callbacks),e=_createForOfIteratorHelper(b);try{for(e.s();!(c=e.n()).done;)for(var f,g=c.value,h=0,i=Object.keys(g);h<i.length;h++)if(f=i[h],d.includes(f)){var j=a._state_update_callbacks[f];j(reactifyMqttStateUpdate(g[f]))}}catch(a){e.e(a)}finally{e.f()}})}},{key:"set_thing",value:function set_thing(a,b){return this.remote_thing_registry.set_thing(a,b)}},{key:"get_thing_state",value:function get_thing_state(a){return this.remote_thing_registry.get_thing_state(a)}},{key:"get_thing_action_state",value:function get_thing_action_state(a,b){return this.remote_thing_registry.get_thing_action_state(a,b)}},{key:"request_new_mqtt_networkmap",value:function request_new_mqtt_networkmap(){return this.remote_thing_registry.request_new_mqtt_networkmap()}},{key:"_on_mqtt_state_update",value:function _on_mqtt_state_update(a){for(var b,c=Object.keys(this._state_update_callbacks),d=0,e=Object.keys(a);d<e.length;d++)if(b=e[d],c.includes(b)){var f=a[b],g=this._state_update_callbacks[b];g(reactifyMqttStateUpdate(f))}}},{key:"reloadThings",value:function reloadThings(){console.log("Thing registry clearing local storage"),this.cache.remove(this.full_network_map_metas_cache_key),this.cache.remove(this.network_lights_metas_cache_key),this.cache.remove(this.network_switches_metas_cache_key),this.cache.remove(this.network_sensors_metas_cache_key),this.cache.remove(this.network_buttons_metas_cache_key),this.cache.remove(this.network_mediaplayers_metas_cache_key),this.cache.remove(this.network_unknowns_metas_cache_key),this.cache.remove(this.scenes_metas_cache_key),location.reload(!1)}},{key:"rebuild_network_map_if_unknown",value:function rebuild_network_map_if_unknown(){if(this.probably_needs_network_rebuild)return this.rebuild_network_map();var a=$.Deferred();return a.resolve(),a}},{key:"rebuild_network_map",value:function rebuild_network_map(){var a=this,b=$.Deferred();return this.get_all_things_meta().then(function(c){a.lights=[],a.switches=[],a.sensor_things=[],a.button_things=[],a.mediaplayer_things=[],a.unknown_things=[],a.scenes=[];var d,e=_createForOfIteratorHelper(c);try{for(e.s();!(d=e.n()).done;){var f=d.value,g=f.thing_type?f.thing_type:"unknown";switch(g){case"light":a.lights.push(f);break;case"switch":a.switches.push(f);break;case"SceneManager":a.scenes.push(f);break;case"sensor":a.sensor_things.push(f);break;case"button":a.button_things.push(f);break;case"media_player":a.mediaplayer_things.push(f);break;case"unknown":default:a.unknown_things.push(f)}}}catch(a){e.e(a)}finally{e.f()}a.cache.cacheSave(a.network_lights_metas_cache_key,a.lights),a.cache.cacheSave(a.network_switches_metas_cache_key,a.switches),a.cache.cacheSave(a.network_unknowns_metas_cache_key,a.unknown_things),a.cache.cacheSave(a.network_sensors_metas_cache_key,a.sensor_things),a.cache.cacheSave(a.network_buttons_metas_cache_key,a.button_things),a.cache.cacheSave(a.network_mediaplayers_metas_cache_key,a.mediaplayer_things),a.cache.cacheSave(a.scenes_metas_cache_key,a.scenes),a.probably_needs_network_rebuild=!1,b.resolve()}),b}},{key:"get_all_things_meta",value:function get_all_things_meta(){var a=this,b=$.Deferred(),c=this.cache.cacheGet_ignoreExpire(this.full_network_map_metas_cache_key);return null==c?(this.uncached_get_all_things_meta(b).then(function(c){a.cache.cacheSave(a.full_network_map_metas_cache_key,c),b.resolve(c)}),b):(b.resolve(c),b)}},{key:"uncached_get_all_things_meta",value:function uncached_get_all_things_meta(){var a=this,b=$.Deferred();return this.remote_thing_registry.ls().then(function(c){var d,e=[],f=[],g=_createForOfIteratorHelper(c);try{for(g.s();!(d=g.n()).done;){var h=d.value,i=a.remote_thing_registry.get_thing_meta(h).then(function(a){return e.push(a)});f.push(i)}}catch(a){g.e(a)}finally{g.f()}$.when.apply(null,f).done(function(){b.resolve(e)})}),b}}]),a}();
"use strict";function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_unsupportedIterableToArray(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(b,c){var d=null==b?null:"undefined"!=typeof Symbol&&b[Symbol.iterator]||b["@@iterator"];if(null!=d){var g,h,j,k,l=[],a=!0,m=!1;try{if(j=(d=d.call(b)).next,0===c){if(Object(d)!==d)return;a=!1}else for(;!(a=(g=j.call(d)).done)&&(l.push(g.value),l.length!==c);a=!0);}catch(a){m=!0,h=a}finally{try{if(!a&&null!=d["return"]&&(k=d["return"](),Object(k)!==k))return}finally{if(m)throw h}}return l}}function _arrayWithHoles(a){if(Array.isArray(a))return a}function _createForOfIteratorHelper(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!c){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=c.call(a)},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,_toPropertyKey(c.key),c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}function _toPropertyKey(a){var b=_toPrimitive(a,"string");return"symbol"===_typeof(b)?b:b+""}function _toPrimitive(a,b){if("object"!==_typeof(a)||null===a)return a;var c=a[Symbol.toPrimitive];if(c!==void 0){var d=c.call(a,b||"default");if("object"!==_typeof(d))return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===b?String:Number)(a)}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){if(b&&("object"===_typeof(b)||"function"==typeof b))return b;if(void 0!==b)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var ThingsPane=function(a){function b(a){var d;_classCallCheck(this,b),d=c.call(this,a);var e,f=[],g={},h=_createForOfIteratorHelper(a.things);try{for(h.s();!(e=h.n()).done;){var i=e.value;f.push(i.props.name),g[i.props.name]=i}}catch(a){h.e(a)}finally{h.f()}var j,k=d.props.local_storage.get("ThingsPane.things_order",f),l=new Set(f),m=new Set(k),n=!1,o=_createForOfIteratorHelper(k.entries());try{for(o.s();!(j=o.n()).done;){var p=_slicedToArray(j.value,2),q=p[0],r=p[1];l.has(r)||(delete k[q],n=!0)}}catch(a){o.e(a)}finally{o.f()}k=k.filter(function(a){return null!=a});for(var s,t=0,u=f;t<u.length;t++)s=u[t],m.has(s)||(k.push(s),n=!0);return d.props.onReorderThings.real_cb=function(){d.setState({reordering:!d.state.reordering})},n&&d.props.local_storage.save("ThingsPane.things_order",k),d.state={things_lookup:g,things_order:k,reordering:!1},d}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"reorder",value:function reorder(a,b){if(!(0>a+b||a+b>=this.state.things_order.length)){var c=this.state.things_order,d=c[a];c[a]=c[a+b],c[a+b]=d,this.props.local_storage.save("ThingsPane.things_order",c),this.setState({things_order:c})}}},{key:"render",value:function render(){var a=this;if(this.state.reordering)return this.render_reordering();var b=this.state.things_order.map(function(b){var c=a.state.things_lookup[b];return React.createElement("li",{key:"".concat(c.props.name,"_thing_li")},c)});return React.createElement("ul",{key:"global_thing_list_pane"},b)}},{key:"render_reordering",value:function render_reordering(){var a=this,b=this.state.things_order.map(function(b,c){var d=a.state.things_lookup[b];return React.createElement("li",{key:"".concat(d.props.name,"_thing_reorder_li")},React.createElement("div",{className:"thing_div row",key:"".concat(d.props.name,"_reorder_div")},React.createElement("div",{className:"col-primary-action"},function reorder_down(){return c==a.state.things_order.length-1?"\u25BC":React.createElement("a",{className:"thing-list-reorder-link",onClick:function onClick(){return a.reorder(c,1)}},"\u25BC")}(),function reorder_up(){return 0==c?"\u25B2":React.createElement("a",{className:"thing-list-reorder-link",onClick:function onClick(){return a.reorder(c,-1)}},"\u25B2")}()),React.createElement("div",{className:"col-fixed-fill"},React.createElement("h3",null,d.props.name))))});return React.createElement("ul",{key:"global_thing_list_pane"},b)}}],[{key:"buildProps",value:function buildProps(a,b){var c={};return c.real_cb=function(){return console.log("You shouldn't see this message")},c.toggle=function(){return c.real_cb()},{key:"global_thing_list",things:b,local_storage:a,onReorderThings:c}}}]),b}(React.Component);
"use strict";function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,_toPropertyKey(c.key),c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}function _toPropertyKey(a){var b=_toPrimitive(a,"string");return"symbol"===_typeof(b)?b:b+""}function _toPrimitive(a,b){if("object"!==_typeof(a)||null===a)return a;var c=a[Symbol.toPrimitive];if(c!==void 0){var d=c.call(a,b||"default");if("object"!==_typeof(d))return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===b?String:Number)(a)}var VisibilityCallback=function(){function a(){_classCallCheck(this,a),this.install_visibility_callback()}return _createClass(a,[{key:"app_became_hidden",value:function app_became_hidden(){}},{key:"app_became_visible",value:function app_became_visible(){}},{key:"install_visibility_callback",value:function install_visibility_callback(){var b=this;if(void 0===this.vis_cb_installed){this.vis_cb_installed=!0;var c,d;"undefined"==typeof document.hidden?"undefined"==typeof document.msHidden?"undefined"!=typeof document.webkitHidden&&(c="webkitHidden",d="webkitvisibilitychange"):(c="msHidden",d="msvisibilitychange"):(c="hidden",d="visibilitychange"),a.warn_if_visibility_not_supported(d),void 0!==d&&document.addEventListener(d,function(){var a=document[c];a?b.app_became_hidden():b.app_became_visible()})}}}],[{key:"warn_if_visibility_not_supported",value:function warn_if_visibility_not_supported(a){void 0!==this.visibility_checked||(this.visibility_checked=!0,void 0===a&&console.log("Visibility changes not supported: UI elements won't auto-refresh"))}}]),a}();
"use strict";function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,_toPropertyKey(c.key),c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}function _toPropertyKey(a){var b=_toPrimitive(a,"string");return"symbol"===_typeof(b)?b:b+""}function _toPrimitive(a,b){if("object"!==_typeof(a)||null===a)return a;var c=a[Symbol.toPrimitive];if(c!==void 0){var d=c.call(a,b||"default");if("object"!==_typeof(d))return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===b?String:Number)(a)}function reactifyMqttStateUpdate(a){for(var b={},c=0,d=Object.keys(a);c<d.length;c++){var e=d[c],f=a[e];if(null!==f&&(b[e]=f,"state"==e)){var g=!!f.toLowerCase;g&&["0","false","off"].includes(f.toLowerCase())&&(b[e]=!1)}}return b}var Zigbee2Mqtt2Flask2js=function(){function a(b){_classCallCheck(this,a),this.socket=null,this.netmap_socket=null,this._on_mqtt_message_cb={},this._ui_display_error=b}return _createClass(a,[{key:"_get",value:function _get(a){var b=this,c=$.Deferred();return $.ajax({url:a,cache:!1,type:"get",dataType:"json",success:c.resolve,error:function error(a){var d="Set error ".concat(a.status," ").concat(a.statusText,": ").concat(a.responseText);console.log(d),b._ui_display_error(d),c.reject()}}),c}},{key:"_put",value:function _put(a,b){var c=this,d=$.Deferred();return $.ajax({url:a,cache:!1,type:"put",data:b,dataType:"json",success:d.resolve,error:function error(a){var b="Set error ".concat(a.status," ").concat(a.statusText,": ").concat(a.responseText);console.log(b),c._ui_display_error(b),d.reject()}}),d}},{key:"ls",value:function ls(){return this._get("/ls")}},{key:"get_world",value:function get_world(){return this._get("/get_world")}},{key:"get_thing_meta",value:function get_thing_meta(a){return this._get("/meta/".concat(a))}},{key:"get_thing_action_meta",value:function get_thing_action_meta(a,b){return this._get("/meta/".concat(a,"/").concat(b))}},{key:"get_thing_state",value:function get_thing_state(a){var b=$.Deferred();return this._get("/get/".concat(a)).then(function(a){b.resolve(reactifyMqttStateUpdate(a))}),b}},{key:"get_thing_action_state",value:function get_thing_action_state(a,b){return this._get("/get/".concat(a,"/").concat(b))}},{key:"set_thing",value:function set_thing(a,b){return this._put("/set/".concat(a),b)}},{key:"subscribe_to_mqtt_stream",value:function subscribe_to_mqtt_stream(a,b){0==Object.keys(this._on_mqtt_message_cb).length&&this._start_mqtt_stream(),this._on_mqtt_message_cb[a]=b}},{key:"unsubscribe_to_mqtt_stream",value:function unsubscribe_to_mqtt_stream(a){delete this._on_mqtt_message_cb[a],0==Object.keys(this._on_mqtt_message_cb).length&&this.stop_mqtt_stream()}},{key:"get_cached_mqtt_networkmap",value:function get_cached_mqtt_networkmap(){return this._get("/mqtt_networkmap")}},{key:"request_new_mqtt_networkmap",value:function request_new_mqtt_networkmap(){var a=this,b=$.Deferred();return this.netmap_socket?b.reject("Netmap request in progress"):(console.log("Requesting new network map"),this.netmap_socket=io.connect("http://"+document.domain+":"+location.port),this.netmap_socket.onAny(console.log),this.netmap_socket.on("mqtt_networkmap",function(c){console.log("Received network map update"),a.netmap_socket=null,b.resolve(c)}),this.netmap_socket.on("disconnect",function(){a.netmap_socket=null,b.resolve(null)}),this._put("/mqtt_networkmap/start_mapping",null)),b}},{key:"_start_mqtt_stream",value:function _start_mqtt_stream(){var a=this,b=function(b){console.log("Received mqtt_thing_msg ",b);for(var c,d=0,e=Object.keys(a._on_mqtt_message_cb);d<e.length;d++)c=e[d],a._on_mqtt_message_cb[c](b)};this.socket=io.connect("http://"+document.domain+":"+location.port),this.socket.on("mqtt_thing_msg",b),this.socket.on("mqtt_networkmap",b),this.socket.on("connect",function(){console.log("Connected to server"),b("Connected to server")}),this.socket.on("disconnect",function(){console.log("Disconnected! Will try reconnecting."),b("Disconnected! Will try reconnecting.")})}},{key:"stop_mqtt_stream",value:function stop_mqtt_stream(){this.socket.destroy(),this.socket=null}}]),a}();
"use strict";function _createForOfIteratorHelper(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!c){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=c.call(a)},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}var showGlobalError=function(a){$("#global_error_msg").text(a),$("#global_error_ui").removeClass("no-error")};$("#global_error_ui_ack").on("click",function(){$("#global_error_msg").text(""),$("#global_error_ui").addClass("no-error")}),window.remote_thing_registry=new Zigbee2Mqtt2Flask2js(showGlobalError),window.local_storage=new LocalStorageManager,window.thing_registry=new ThingRegistry(local_storage,remote_thing_registry);var INTERESTING_PLOT_METRICS=["temperature","humidity"],app_visibility=new VisibilityCallback;app_visibility.app_became_visible=function(){console.log("App became visible, will refresh state"),thing_registry.updateWorldState()},thing_registry.rebuild_network_map_if_unknown().then(function(){var a,b=[],c=_createForOfIteratorHelper(thing_registry.lights);try{for(c.s();!(a=c.n()).done;){var d=a.value,e=Light.buildProps(thing_registry,d);b.push(React.createElement(Light,e))}}catch(a){c.e(a)}finally{c.f()}var f,g=_createForOfIteratorHelper(thing_registry.switches);try{for(g.s();!(f=g.n()).done;){var h=f.value,i=Switch.buildProps(thing_registry,h);b.push(React.createElement(Switch,i))}}catch(a){g.e(a)}finally{g.f()}var j=ThingsPane.buildProps(local_storage,b);ReactDOM.createRoot(document.querySelector("#things_root")).render(React.createElement(ThingsPane,j)),ReactDOM.createRoot(document.querySelector("#others_root")).render([React.createElement(ScenesPane,{key:"scenes_list",thing_registry:thing_registry,scenes:thing_registry.scenes[0]}),React.createElement(SensorsPane,SensorsPane.buildProps(thing_registry)),React.createElement(MediaPlayerList,MediaPlayerList.buildProps(thing_registry))]),ReactDOM.createRoot(document.querySelector("#sensors_history")).render([React.createElement(SensorsHistoryPane,SensorsHistoryPane.buildProps(thing_registry,INTERESTING_PLOT_METRICS))]),ReactDOM.createRoot(document.querySelector("#config")).render([React.createElement(ConfigPane,ConfigPane.buildProps(thing_registry,remote_thing_registry,j.onReorderThings))])}),thing_registry.updateWorldState();
