"use strict";class CamViewer extends React.Component{static buildProps(api_base_path="",svc_full_url=""){return{key:"cam_viewer",api_base_path,svc_full_url}}constructor(props){super(props);this.state={imageTimestamp:Date.now(),isLoading:false,isRecording:false,recordDuration:20,recordingTimeLeft:0};this.countdownInterval=null;this.onSnapRequested=this.onSnapRequested.bind(this);this.onRecordRequested=this.onRecordRequested.bind(this)}on_app_became_visible(){}onSnapRequested(){this.setState({isLoading:true});mAjax({url:`${this.props.api_base_path}/snap`,type:"get",success:()=>{console.log("Snapshot captured");setTimeout(()=>{this.setState({imageTimestamp:Date.now(),isLoading:false})},500)},error:err=>{showGlobalError("Failed to capture snapshot: "+err);this.setState({isLoading:false})}})}onRecordRequested(){const secs=this.state.recordDuration;this.setState({isRecording:true,recordingTimeLeft:secs});mAjax({url:`${this.props.api_base_path}/record?secs=${secs}`,type:"get",success:response=>{console.log(`Recording started for ${secs} seconds`);this.countdownInterval=setInterval(()=>{this.setState(prevState=>{const newTime=prevState.recordingTimeLeft-1;if(newTime<=0){clearInterval(this.countdownInterval);return{isRecording:false,recordingTimeLeft:0}}return{recordingTimeLeft:newTime}})},1000)},error:err=>{showGlobalError("Failed to start recording: "+err.response);this.setState({isRecording:false,recordingTimeLeft:0})}})}render(){return React.createElement("section",{id:"zwm_reolink_doorcam"},React.createElement("div",null,React.createElement("button",{onClick:this.onSnapRequested,disabled:this.state.isLoading||this.state.isRecording},this.state.isLoading?"Capturing...":"Take New Snapshot"),React.createElement("button",{onClick:this.onRecordRequested,disabled:this.state.isRecording||this.state.isLoading},this.state.isRecording?`Recording (${this.state.recordingTimeLeft}s)...`:`Record Video (${this.state.recordDuration}s)`),React.createElement("button",{onClick:()=>window.location.href=`${this.props.svc_full_url}/nvr`},"View Recordings"),React.createElement("input",{type:"range",min:"10",max:"100",value:this.state.recordDuration,onChange:e=>this.setState({recordDuration:parseInt(e.target.value)}),disabled:this.state.isRecording})),React.createElement("a",{href:`${this.props.api_base_path}/lastsnap?t=${this.state.imageTimestamp}`},React.createElement("img",{className:"img-always-on-screen quite-round",src:`${this.props.api_base_path}/lastsnap?t=${this.state.imageTimestamp}`,alt:"Last doorbell snap"})))}}
