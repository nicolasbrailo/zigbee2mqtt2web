"use strict";class ShellyPlugMonitor extends React.Component{static buildProps(){return{key:"ShellyPlugMonitor"}}constructor(props){super(props);this.state={devices:null};this.fetchStats=this.fetchStats.bind(this);this.refreshInterval=null}async componentDidMount(){this.fetchStats();this.refreshInterval=setInterval(this.fetchStats,10000)}componentWillUnmount(){if(this.refreshInterval){clearInterval(this.refreshInterval)}}on_app_became_visible(){this.fetchStats()}fetchStats(){mJsonGet("/all_stats",res=>{this.setState({devices:res})})}formatUptime(seconds){const months=Math.floor(seconds/(30*24*3600));seconds%=30*24*3600;const days=Math.floor(seconds/(24*3600));seconds%=24*3600;const hours=Math.floor(seconds/3600);seconds%=3600;const mins=Math.floor(seconds/60);const secs=seconds%60;const parts=[];if(months>0)parts.push(`${months} month${months!==1?"s":""}`);if(days>0)parts.push(`${days} day${days!==1?"s":""}`);if(hours>0)parts.push(`${hours} hour${hours!==1?"s":""}`);if(mins>0)parts.push(`${mins} min${mins!==1?"s":""}`);if(secs>0||parts.length===0)parts.push(`${secs} sec${secs!==1?"s":""}`);return parts.join(", ")}renderDevice(name,stats){const powerStatus=stats.powered_on?"ON":"OFF";const powerClass=stats.powered_on?"bg-success":"bg-error";return React.createElement("div",{key:name,className:"col-6 col-12-md"},React.createElement("div",{className:"card"},React.createElement("header",{className:"row is-vertical-align"},React.createElement("h4",{className:"is-marginless",style:{flex:1}},name),React.createElement("span",{className:"text-grey is-small"},"Last updated: ",stats.device_current_time),React.createElement("span",{className:`${powerClass} text-white is-a-bit-rounded`,style:{marginLeft:"1rem",padding:"0.3rem 0.8rem"}},powerStatus)),React.createElement("table",null,React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,"Power"),React.createElement("td",null,stats.active_power_watts.toFixed(1)," W")),React.createElement("tr",null,React.createElement("td",null,"Current"),React.createElement("td",null,stats.current_amps.toFixed(3)," A")),React.createElement("tr",null,React.createElement("td",null,"Voltage"),React.createElement("td",null,stats.voltage_volts.toFixed(1)," V")),React.createElement("tr",null,React.createElement("td",null,"Temperature"),React.createElement("td",null,stats.temperature_c.toFixed(1)," \xB0C")),React.createElement("tr",null,React.createElement("td",null,"Energy (last min)"),React.createElement("td",null,stats.last_minute_energy_use_watt_hour.toFixed(3)," Wh")),React.createElement("tr",null,React.createElement("td",null,"Energy (lifetime)"),React.createElement("td",null,stats.lifetime_energy_use_watt_hour.toFixed(3)," Wh")),React.createElement("tr",null,React.createElement("td",null,"Uptime"),React.createElement("td",null,this.formatUptime(stats.device_uptime))),React.createElement("tr",null,React.createElement("td",null,"IP"),React.createElement("td",null,stats.device_ip))))))}render(){if(!this.state.devices){return React.createElement("div",{className:"app-loading"},"Loading...")}const deviceNames=Object.keys(this.state.devices);return React.createElement("div",{id:"ShellyPlugContainer"},React.createElement("h3",{className:"is-vertical-align"},React.createElement("img",{src:"/favicon.ico",alt:"Shelly Plug Monitor",style:{width:"32px",height:"32px",marginRight:"10px"}}),"Shelly Plug Monitor"),deviceNames.length===0?React.createElement("p",null,"No devices found"):React.createElement("div",{className:"row"},deviceNames.map(name=>this.renderDevice(name,this.state.devices[name]))))}}
