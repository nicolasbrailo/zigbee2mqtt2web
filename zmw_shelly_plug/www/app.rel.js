"use strict";class ShellyPlugMonitor extends React.Component{static buildProps(){return{key:"ShellyPlugMonitor"}}constructor(props){super(props);this.state={devices:null};this.fetchStats=this.fetchStats.bind(this);this.refreshInterval=null}async componentDidMount(){this.fetchStats();this.refreshInterval=setInterval(this.fetchStats,10000)}componentWillUnmount(){if(this.refreshInterval){clearInterval(this.refreshInterval)}}on_app_became_visible(){this.fetchStats()}fetchStats(){mJsonGet("/all_stats",res=>{this.setState({devices:res})})}formatNumber(value,decimals){if(value===null||value===undefined){return"?"}return value.toFixed(decimals)}formatUptime(seconds){const months=Math.floor(seconds/(30*24*3600));seconds%=30*24*3600;const days=Math.floor(seconds/(24*3600));seconds%=24*3600;const hours=Math.floor(seconds/3600);seconds%=3600;const mins=Math.floor(seconds/60);const secs=seconds%60;const parts=[];if(months>0)parts.push(`${months} month${months!==1?"s":""}`);if(days>0)parts.push(`${days} day${days!==1?"s":""}`);if(hours>0)parts.push(`${hours} hour${hours!==1?"s":""}`);if(mins>0)parts.push(`${mins} min${mins!==1?"s":""}`);if(secs>0||parts.length===0)parts.push(`${secs} sec${secs!==1?"s":""}`);return parts.join(", ")}renderDevice(name,stats){const powerStatus=stats.powered_on?"Power: ON":"Power: OFF";const powerClass=stats.powered_on?"bg-success":"bg-error";const uptime=stats.device_uptime!==null&&stats.device_uptime!==undefined?this.formatUptime(stats.device_uptime):"?";const ipDisplay=stats.device_ip?stats.device_ip:React.createElement("span",{className:"warn"},"device is offline");const cardClass=stats.online?"card hint":"card warn";return React.createElement("div",{key:name,className:cardClass},React.createElement("p",null,React.createElement("b",null,name),", ",powerStatus," - ",React.createElement("small",null,"updated: ",stats.device_current_time||"?")),React.createElement("table",{style:{width:"100%",maxWidth:"500px",tableLayout:"fixed"}},React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,"Power"),React.createElement("td",null,this.formatNumber(stats.active_power_watts,1)," W")),React.createElement("tr",null,React.createElement("td",null,"Current"),React.createElement("td",null,this.formatNumber(stats.current_amps,3)," A")),React.createElement("tr",null,React.createElement("td",null,"Voltage"),React.createElement("td",null,this.formatNumber(stats.voltage_volts,1)," V")),React.createElement("tr",null,React.createElement("td",null,"Temperature"),React.createElement("td",null,this.formatNumber(stats.temperature_c,1)," \xB0C")),React.createElement("tr",null,React.createElement("td",null,"Energy (last min)"),React.createElement("td",null,this.formatNumber(stats.last_minute_energy_use_watt_hour,3)," Wh")),React.createElement("tr",null,React.createElement("td",null,"Energy (lifetime)"),React.createElement("td",null,this.formatNumber(stats.lifetime_energy_use_watt_hour,3)," Wh")),React.createElement("tr",null,React.createElement("td",null,"Uptime"),React.createElement("td",{style:{wordBreak:"break-word"}},uptime)),React.createElement("tr",null,React.createElement("td",null,"IP"),React.createElement("td",null,ipDisplay)))))}render(){if(!this.state.devices){return React.createElement("div",{className:"app-loading"},"Loading...")}const deviceNames=Object.keys(this.state.devices);return React.createElement("div",{id:"ShellyPlugContainer"},deviceNames.length===0?React.createElement("p",null,"No devices found"):React.createElement("div",null,deviceNames.map(name=>this.renderDevice(name,this.state.devices[name]))))}}
