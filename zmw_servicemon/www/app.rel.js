"use strict";class ServiceMonitor extends React.Component{static buildProps(){return{key:"ServiceMonitor"}}constructor(props){super(props);this.state={services:null,systemdServicesStdout:null,recentErrors:null}}componentDidMount(){this.on_app_became_visible()}on_app_became_visible(){mJsonGet("/ls",data=>{this.setState({services:data})});mJsonGet("/recent_errors",data=>{this.setState({recentErrors:data})});mAjax({url:"/systemd_status",type:"GET",dataType:"text",success:stdout=>{this.setState({systemdServicesStdout:stdout})},error:showGlobalError})}isStale(lastSeen){if(!lastSeen)return true;const last=new Date(lastSeen.replace(" ","T"));const now=new Date;const diffMs=now-last;const diffMinutes=diffMs/1000/60;return diffMinutes>5}renderServices(){if(!this.state.services)return React.createElement("div",null,"Loading services...");return React.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"10px",marginBottom:"20px"}},Object.values(this.state.services).map(srv=>React.createElement("div",{key:srv.name,className:"card",style:{padding:"10px"}},React.createElement("h4",{style:{margin:"0 0 5px 0"}},srv.www?React.createElement("a",{href:srv.www,target:"_blank",rel:"noopener noreferrer"},React.createElement("img",{src:`${srv.www}/favicon.ico`,style:{width:"16px",height:"16px",marginRight:"5px",verticalAlign:"middle"}}),srv.name):React.createElement("strong",null,srv.name)),React.createElement("div",{style:{fontSize:"0.9em",color:this.isStale(srv.last_seen)?"red":"inherit",marginBottom:"5px"}},srv.last_seen||"Service down"),srv.methods&&srv.methods.length>0&&React.createElement("div",{style:{fontSize:"0.85em",color:"#666"}},React.createElement("em",null,"Methods:")," ",srv.methods.join(", ")))))}renderSystemdStatus(){return React.createElement("div",null,React.createElement("h1",null,"Systemd services status"),!this.state.systemdServicesStdout?React.createElement("div",null,"Loading systemd..."):React.createElement("pre",{dangerouslySetInnerHTML:{__html:this.state.systemdServicesStdout}}))}renderRecentErrors(){if(!this.state.recentErrors)return React.createElement("div",null,"Loading errors...");const errors=this.state.recentErrors;if(errors.length===0){return React.createElement("div",null,React.createElement("h1",null,"Recent Errors"),React.createElement("p",null,"No errors detected! All services running cleanly."))}return React.createElement("div",{style:{margin:"20px"}},React.createElement("h1",null,"Recent Errors (",errors.length,")"),React.createElement("table",{style:{width:"100%",borderCollapse:"collapse"}},React.createElement("thead",null,React.createElement("tr",{style:{backgroundColor:"#333",color:"white"}},React.createElement("th",{style:{padding:"10px",textAlign:"left"}},"Time"),React.createElement("th",{style:{padding:"10px",textAlign:"left"}},"Service"),React.createElement("th",{style:{padding:"10px",textAlign:"left"}},"Level"),React.createElement("th",{style:{padding:"10px",textAlign:"left"}},"Message"))),React.createElement("tbody",null,errors.slice().reverse().map((err,idx)=>{const priorityColors={"EMERG":"#ff0000","ALERT":"#ff3300","CRIT":"#ff6600","ERR":"#ff9900","WARNING":"#ffcc00"};return React.createElement("tr",{key:idx,style:{borderBottom:"1px solid #ddd"}},React.createElement("td",{style:{padding:"8px",fontSize:"12px"}},new Date(err.timestamp).toLocaleString()),React.createElement("td",{style:{padding:"8px",fontWeight:"bold"}},err.service),React.createElement("td",{style:{padding:"8px",color:priorityColors[err.priority_name]||"#999",fontWeight:"bold"}},err.priority_name),React.createElement("td",{style:{padding:"8px",fontFamily:"monospace",fontSize:"12px"}},err.message))}))))}render(){return React.createElement("div",{id:"ServiceMonitorContainer"},React.createElement("h1",null,React.createElement("img",{src:"/favicon.ico",alt:"Service mon"})," Service Monitor"),this.renderServices(),this.renderSystemdStatus(),this.renderRecentErrors())}};z2mStartReactApp("#app_root",ServiceMonitor);
